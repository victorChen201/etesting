---
title: Lmbench-latency
date: 2016-12-28 16:22:52
tags:
	- D05
	- CentOS
categories:
	- Estuary
	- Documents
---

- **Dependency:**

  ```bash
  yum install numactl
  ```

- **Source code:**
  *Openlab:192.168.1.101:/home/chenzhihui/Ali-test/lmbench-3.0-a9*

- **Build:**

  ```bash
  cd lmbench-3.0-a9
  sed -i 's/--static//' src/Makefile
  sed -i 's/-O/-O2/g' src/Makefile
  make OS=lmbench 
  ```

- **Test:**
  Local memory access:
  ```bash
  numactl --membind=0 --physcpubind=0 ./lat_mem_rd -P 1 -t 32M 128
  numactl --membind=0 --physcpubind=0-3 ./lat_mem_rd -P 4 -t 32M 128
  numactl --membind=0 --physcpubind=0-15 ./lat_mem_rd -P 16 -t 32M 128
  numactl --physcpubind=0-31 ./lat_mem_rd -P 32 -t 32M 128
  ```
  <!--more-->
  Result:
  ```bash
[root@CentOS lmbench]# numactl --membind=0 --physcpubind=0 ./lat_mem_rd -P 1 -t  32M 128
"stride=128
0.00049 1.671
0.00098 1.671
0.00195 1.671
0.00293 1.671
0.00391 1.671
0.00586 1.671
0.00781 1.672
0.01172 1.671
0.01562 1.672
0.02344 1.672
0.03125 1.673
0.04688 1.672
0.06250 8.156
0.09375 8.202
0.12500 7.522
0.18750 7.522
0.25000 7.522
0.37500 7.522
0.50000 7.523
0.75000 7.612
1.00000 10.712
1.50000 21.268
2.00000 22.259
3.00000 26.522
4.00000 27.121
6.00000 27.920
8.00000 30.759
12.00000 44.001
16.00000 76.624
24.00000 110.425
32.00000 124.518

[root@CentOS lmbench]# numactl --membind=0 --physcpubind=0-3 ./lat_mem_rd -P 4 - t 32M 128t
"stride=128
0.00049 1.730
0.00098 1.671
0.00195 1.671
0.00293 1.671
0.00391 1.671
0.00586 1.671
0.00781 1.671
0.01172 1.671
0.01562 1.672
0.02344 1.671
0.03125 1.674
0.04688 1.672
0.06250 15.654
0.09375 12.877
0.12500 16.605
0.18750 17.279
0.25000 16.699
0.37500 26.290
0.50000 28.596
0.75000 30.646
1.00000 32.023
1.50000 32.442
2.00000 32.890
3.00000 45.792
4.00000 69.820
6.00000 120.341
8.00000 134.030
12.00000 143.907
16.00000 142.792
24.00000 143.624
32.00000 143.992

[root@CentOS lmbench]# numactl --membind=0 --physcpubind=0-15 ./lat_mem_rd -P 16  -t 32M 128
"stride=128
0.00049 1.671
0.00098 1.671
0.00195 1.671
0.00293 1.671
0.00391 1.671
0.00586 1.671
0.00781 1.671
0.01172 1.671
0.01562 1.672
0.02344 1.672
0.03125 1.674
0.04688 1.673
0.06250 16.064
0.09375 12.808
0.12500 16.037
0.18750 16.250
0.25000 17.189
0.37500 24.823
0.50000 28.581
0.75000 32.417
1.00000 41.866
1.50000 95.047
2.00000 120.481
3.00000 136.717
4.00000 141.553
6.00000 144.689
8.00000 147.651
12.00000 151.912
16.00000 155.266
24.00000 154.515
32.00000 157.377

[root@CentOS lmbench]# numactl --physcpubind=0-31 ./lat_mem_rd -P 32 -t 32M 128
"stride=128
0.00049 1.672
0.00098 1.672
0.00195 1.672
0.00293 1.672
0.00391 1.674
0.00586 1.672
0.00781 1.672
0.01172 1.673
0.01562 1.672
0.02344 1.672
0.03125 1.674
0.04688 1.673
0.06250 14.663
0.09375 13.778
0.12500 16.345
0.18750 16.240
0.25000 16.192
0.37500 19.412
0.50000 26.355
0.75000 23.112
1.00000 31.792
1.50000 24.323
2.00000 64.405
3.00000 127.904
4.00000 110.334
6.00000 143.287
8.00000 146.987
12.00000 147.054
16.00000 149.131
24.00000 151.960
32.00000 156.711

  ```
  Cross die memory access:
  ```bash
  numactl --membind=1 --physcpubind=0 ./lat_mem_rd -P 1 -t 32M 128
  numactl --membind=1 --physcpubind=0-3 ./lat_mem_rd -P 4 -t 32M 128
  numactl --membind=1 --physcpubind=0-15 ./lat_mem_rd -P 16 -t 32M 128
  ```
  Result:
  ```bash
[root@CentOS lmbench]# numactl --membind=1 --physcpubind=0 ./lat_mem_rd -P 1 -t  32M 128
"stride=128
0.00049 1.671
0.00098 1.671
0.00195 1.671
0.00293 1.671
0.00391 1.671
0.00586 1.671
0.00781 1.671
0.01172 1.672
0.01562 1.672
0.02344 1.672
0.03125 1.673
0.04688 1.672
0.06250 8.273
0.09375 8.211
0.12500 7.523
0.18750 7.523
0.25000 7.523
0.37500 7.523
0.50000 7.523
0.75000 7.736
1.00000 15.666
1.50000 40.687
2.00000 43.171
3.00000 48.555
4.00000 49.821
6.00000 51.001
8.00000 51.592
12.00000 63.426
16.00000 87.655
24.00000 131.741
32.00000 148.346

[root@CentOS lmbench]#   numactl --membind=1 --physcpubind=0-3 ./lat_mem_rd -P 4  -t 32M 128
"stride=128
0.00049 1.671
0.00098 1.671
0.00195 1.671
0.00293 1.671
0.00391 1.671
0.00586 1.671
0.00781 1.671
0.01172 1.671
0.01562 1.672
0.02344 1.671
0.03125 1.674
0.04688 1.673
0.06250 18.009
0.09375 13.443
0.12500 16.678
0.18750 17.318
0.25000 17.727
0.37500 39.679
0.50000 41.364
0.75000 46.217
1.00000 48.321
1.50000 49.187
2.00000 49.780
3.00000 57.128
4.00000 88.882
6.00000 134.363
8.00000 154.514
12.00000 167.403
16.00000 169.047
24.00000 169.842
32.00000 172.978

[root@CentOS lmbench]# numactl --membind=1 --physcpubind=0-15 ./lat_mem_rd -P 16 -t 32M 128 
"stride=128
0.00049 1.681
0.00098 1.671
0.00195 1.671
0.00293 1.671
0.00391 1.671
0.00586 1.671
0.00781 1.671
0.01172 1.671
0.01562 1.671
0.02344 1.671
0.03125 1.674
0.04688 1.673
0.06250 15.422
0.09375 12.845
0.12500 16.122
0.18750 16.624
0.25000 17.067
0.37500 40.222
0.50000 42.627
0.75000 48.169
1.00000 63.064
1.50000 118.494
2.00000 140.895
3.00000 162.166
4.00000 166.270
6.00000 172.426
8.00000 172.472
12.00000 175.286
16.00000 176.584
24.00000 181.514
32.00000 183.856

  ```
